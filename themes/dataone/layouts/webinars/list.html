{{- define "main" -}}

  <!-- The current page, to pass along to children templates -->
  {{ $page := $ }}

  <!-- Get webinars, excluding the upcoming webinar advertised in header -->
  {{ $webinarPages := where $page.Pages "Kind" "page" }}

  <!-- Get upcoming webinar -->
  {{ $upcomingWebinarPage := partial "functions/getUpcomingWebinar" (dict "webinars" $webinarPages) }}

  <!-- Make the header Block -->
  {{ with $headerBlock := .Params.header }}
    {{ $headerBlock = merge $headerBlock (dict "next_webinar" $upcomingWebinarPage) }}
    {{ partial "blocks/header/header--webinars.html" (dict "Block" $headerBlock "Page" $page) }}
  {{ end }}

  <!-- If there are sections in the webinar index page content, generate them -->
  {{- range .Params.page_sections -}}
    {{ if .template }}
      {{ partial (printf "blocks/%s/%s.html" .template .template) (dict "Block" . "Page" $page) }}
    {{ end }}
  {{- end -}}

{{- end -}}