<!-- in order to pass on page parameters from within loops -->
{{ $page := .Page }}
<!-- blockname -->
{{ $bn := "header" }}

{{ $tagline := .Block.tagline | default "Data Observation Network for Earth" }}

{{ $bkgImg := "" }}
{{ $src := .Block.image }}
{{ with $src }}
  {{ $imageResource := partial "functions/getImage" (dict "image" . "Page" $page) }}
  {{ if gt $imageResource.Width 4000 }}
    {{ $imageResource = $imageResource.Resize "4000x" }}
  {{ end }}
  {{ $bkgImg = printf ` style="--background-image:url('%s');"` $imageResource.RelPermalink | safeHTMLAttr  }}
{{ end }}

<header class="header header--hero-image header--overlay-subtle header--homepage" {{ $bkgImg }}>
  <div class="header__content">
    <div class="header__logo">

      {{- partial "blocks/logo/logo" (dict "Block" (dict "type" "homepage") "Page" $page ) -}}
    </div>

    {{ with $tagline}}
      <div class="header__tagline">
        {{ $tagline }}
      </div>
    {{ end }}

    <div class="header__search">
      {{- partial "blocks/d1search/d1search" (dict "Block" .Block "Page" $page ) -}}
    </div>

    <!-- Parameters for the advanced search button -->
    {{ $buttonParams := dict "type" "external website" "external_link" "https://search.dataone.org/data" "text" "Advanced search" "color" "quaternary" }}
    {{ partial "blocks/button/button" (dict "Block" $buttonParams "Page" $page )}}

  </div>

  <div class="{{ $bn }}__logos">
    <!-- Logos -->
    {{ $buttonBlock := dict "type" "internal page" "color" "quaternary" "text" "See our entire network" "internal_link" "/network/_index.md" }}
    {{ $logosBlock := slice }}
    <!-- The nodes with the most data -->
    {{ $topNodes := slice "IEDA: Marine-Geo Digital Library" "NOAA NCEI Environmental Data Archive" "PANGAEA Data Publisher for Earth and Environmental Science" "PISCO MN" "TERN Australia" "USGS Science Data Catalog" "the Digital Archaeological Record" "Dryad Digital Repository" "National Ecological Observatory Network" "Merritt Repository" "LTER Network Member Node" }}

    {{ $nodeData := $page.Site.Data.membernodes.nodes }}

    {{ range $node := $nodeData }}
      {{ if in $topNodes $node.name }}
        {{ $logosBlock = $logosBlock | append $node }}
      {{ end }}
    {{ end }}

    {{ $logosBarBlock := dict "button" $buttonBlock "logos" $logosBlock "style" "dark-background" }}
    {{ partial "blocks/logos-bar/logos-bar" (dict "Block" $logosBarBlock "Page" $page) }}
  </div>

</header>