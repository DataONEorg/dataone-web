<!-- in order to pass on page parameters from within loops  -->
{{ $page := .Page }}

{{ $classes := "" }}
{{ with .Block.type }}
  {{ if ne . "default" }}
    {{ $classes = print $classes " section--" . }}
  {{ end }}
{{ end }}

<!-- split has a special layout, all others follow the standard layout -->
{{ if ne .Block.type "split" }}

  {{ with .Block.background }}
    {{ if ne . "default" }}
      {{ $classes = print $classes " section--bkg-" . }}
    {{ end }}
  {{ end }}

  <section class="section{{ $classes }}">
    <div class = "section__inner">
      {{ if  partial "functions/hasValues" .Block.icon }}
      {{- with .Block.icon -}}
      <div class="section__icon">
        {{- partial "blocks/icon/icon" (dict "Block" . "Page" $page) -}}
      </div>
      {{- end -}}
      {{ end }}
      {{- with .Block.title -}}
      <h2 class="section__title">
        {{- . | markdownify  -}}
      </h2>
      {{- end -}}
      {{- with .Block.intro -}}
      <div class="section__intro">
        {{- . | markdownify -}}
      </div>
      {{- end -}}
      {{ if  partial "functions/hasValues" .Block.blocks }}
      <div class="section__blocks">
      {{- range .Block.blocks -}}
        {{ if .template }}
          {{ partial (printf "blocks/%s/%s.html" .template .template) (dict "Block" . "Page" $page) }}
        {{ end }}
      {{- end -}}
      </div>
      {{ end }}
      {{ if and (partial "functions/hasValues" .Block.button) (ne .Block.button.text "") (ne .Block.button.text " ") }}
      <div class="section__button">
        {{- partial "blocks/button/button" (dict "Block" .Block.button "Page" $page) -}}
      </div>
      {{ end }}
    </div>
  </section>
  
{{ else }}
<!-- split section layout -->

  {{ $half1Bkg := "" }}
  {{ with .Block.background }}
    {{ if ne . "default" }}
      {{ $half1Bkg = print $half1Bkg " section--bkg-" . }}
    {{ end }}
  {{ end }}
  {{ $half2Bkg := "" }}
  {{ with .Block.background2 }}
    {{ $half2Bkg = print $half2Bkg " section--bkg-" . }}
  {{ end }}
  
  <section class="section section--split{{ $half1Bkg }}">
    
    {{- range  $index, $block := first 2 .Block.blocks -}}
      {{ if $block.template }}
      <!-- because go starts counting at zero -->
      {{ $index = add $index 1 }}
      <!-- add background class for second half -->
      <div class="section__half{{ $index }}{{ if eq $index 2 }}{{ $half2Bkg }}{{ end }}">
        <div class="section__half{{ $index }}-inner">
          {{ partial (printf "blocks/%s/%s.html" $block.template $block.template) (dict "Block" $block "Page" $page) }}
        </div>
      </div>
      {{ end }}
    {{- end -}}

  </section>

{{ end }}
