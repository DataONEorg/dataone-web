<!-- in order to pass on page parameters from within loops -->
{{ $page := .Page }}
<!-- bn - block name -->
{{ $bn := "section" }}

{{ $classes := $bn }}
{{ with .Block.type }}
  {{ if ne . "default" }}
    {{ $classes = printf "%s %s--%s" $classes $bn . }}
  {{ end }}
{{ end }}

<!-- split has a special layout, all others follow the standard layout -->
{{ if ne .Block.type "split" }}

  <!-- background colour classess -->
  {{ with .Block.background }}
    {{ if ne . "default" }}
      {{ $classes = printf "%s %s--bkg-%s" $classes $bn . }}
    {{ end }}
  {{ end }}

  <!-- SVG background for some section types -->
  {{ $svg := "" }}

  {{ if eq .Block.background "wave" }}
    {{ $svg = partial "blocks/svg/svg" (dict "Block" (dict "name" "wave-section") "Page" $page) }}
  {{ else if eq .Block.background "data-wave" }}
    {{ $svg = partial "blocks/svg/svg" (dict "Block" (dict "name" "data-wave") "Page" $page) }}
  {{ end }}

  <section class="{{ $classes }}" {{ with .Block.id }} id="{{ . }}" {{ end }}>
    <!-- SVG-BACKGROUND -->
    {{ with $svg }}
      <div class="{{ $bn }}__svg-background">
        {{ . }}
      </div>
    {{ end }}
    <div class="{{ $bn }}__inner">
      <!-- ICON -->
      {{ if partial "functions/hasValues" .Block.icon }}
        {{- with .Block.icon -}}
          <div class="{{ $bn }}__icon">
            {{- partial "blocks/icon/icon" (dict "Block" . "Page" $page) -}}
          </div>
        {{- end -}}
      {{ end }}
      <!-- TITLE -->
      {{- with .Block.title -}}
        <h2 class="{{ $bn }}__title markdown">
          {{- . | markdownify  -}}
        </h2>
      {{- end -}}
      <!-- INTRO -->
      {{- with .Block.intro -}}
        <div class="{{ $bn }}__intro markdown">
          {{- . | markdownify -}}
        </div>
      {{- end -}}
      <!-- SUB-SECTION BLOCKS -->
      {{ if  partial "functions/hasValues" .Block.blocks }}
        <div class="{{ $bn }}__blocks">
          {{- range .Block.blocks -}}
            {{ if .template }}
              {{ partial (printf "blocks/%s/%s.html" .template .template) (dict "Block" . "Page" $page) }}
            {{ end }}
          {{- end -}}
        </div>
      {{ end }}
      {{ if and (partial "functions/hasValues" .Block.button) (ne .Block.button.text "") (ne .Block.button.text " ") }}
        <div class="{{ $bn }}__button">
          {{- partial "blocks/button/button" (dict "Block" .Block.button "Page" $page) -}}
        </div>
      {{ end }}
    </div>
  </section>

{{ else }}
  <!-- split section layout -->

  <!-- background for the first half of the split layout -->
  {{ $half1Bkg := "" }}
  {{ with .Block.background }}
    {{ if ne . "default" }}
      {{ $half1Bkg = print $half1Bkg " section--bkg-" . }}
    {{ end }}
  {{ end }}
  <!-- background class for the second half of the split layout -->
  {{ $half2Bkg := "" }}
  {{ with .Block.background2 }}
    {{ $half2Bkg = print $half2Bkg " section section--bkg-" . }}
  {{ end }}

  <section class="section section--split{{ $half1Bkg }}">
    {{- range  $index, $block := first 2 .Block.blocks -}}
      {{ if $block.template }}
        <!-- because go starts counting at zero -->
        {{ $index = add $index 1 }}
        <!-- add background class for second half -->
        <div class="{{ $bn }}__half{{ $index }}{{ if eq $index 2 }}{{ $half2Bkg }}{{ end }}">
          <div class="{{ $bn }}__half{{ $index }}-inner">
            {{ partial (printf "blocks/%s/%s.html" $block.template $block.template) (dict "Block" $block "Page" $page) }}
          </div>
        </div>
      {{ end }}
    {{- end -}}

  </section>

{{ end }}